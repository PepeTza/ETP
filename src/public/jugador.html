<!DOCTYPE html>

<script>

    ws = new WebSocket("ws://localhost:1234");

    let user;
    let botones = [];
    let botonesUsados = [];
    let palabra;
    let palabraO;
    let inicio = false;
    let general = [];
    
    ws.addEventListener('open', (data) => {

        botones = [q, w, e, r, t, y, u, i, o, p,     
              a, s, d, f, g, h, j, k, l, 単, 
              z, x, c, v, b, n, m];

        submit.onclick = () => {
            if(username.value.length<2){

                window.alert("El nombre de usuario debe contener por lo menos dos caracteres");
            }
            else if (username.value.indexOf(" ")==-1){

                user = username.value;
                ws.send(user);
                submit.disabled = true;
                username.disabled = true; 
        
                if(inicio){

                    for (i=0; i<botones.length; i++) botones[i].disabled = false;
                }
                else{

                    window.alert("Espera que inicie la partida");
                }
            }
            else if(username.disabled){

                window.alert('El nombre de usuario no puede contener espacios');
            }
        }

        q.onclick = () => {

            ws.send(q.value + ` ${user}`);
            botonesUsados.push(q);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        w.onclick = () => {

            ws.send(w.value + ` ${user}`);
            botonesUsados.push(w);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        e.onclick = () => {

            ws.send(e.value + ` ${user}`);
            botonesUsados.push(e);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        r.onclick = () => {

            ws.send(r.value + ` ${user}`);
            botonesUsados.push(r);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        t.onclick = () => {

            ws.send(t.value + ` ${user}`);
            botonesUsados.push(t);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        y.onclick = () => {

            ws.send(t.value + ` ${user}`);
            botonesUsados.push(y);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        u.onclick = () => {

            ws.send(u.value + ` ${user}`);
            botonesUsados.push(u);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        i.onclick = () => {

            ws.send(i.value + ` ${user}`);
            botonesUsados.push(i);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        o.onclick = () => {

            ws.send(o.value + ` ${user}`);
            botonesUsados.push(o);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        p.onclick = () => {

            ws.send(p.value + ` ${user}`);
            botonesUsados.push(p);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        a.onclick = () => {

            ws.send(a.value + ` ${user}`);
            botonesUsados.push(a);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        s.onclick = () => {

            ws.send(s.value + ` ${user}`);
            botonesUsados.push(s);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        d.onclick = () => {

            ws.send(d.value + ` ${user}`);
            botonesUsados.push(d);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        f.onclick = () => {

            ws.send(f.value + ` ${user}`);
            botonesUsados.push(f);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        g.onclick = () => {

            ws.send(g.value + ` ${user}`);
            botonesUsados.push(g);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        h.onclick = () => {

            ws.send(h.value + ` ${user}`);
            botonesUsados.push(h);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        j.onclick = () => {

            ws.send(j.value + ` ${user}`);
            botonesUsados.push(j);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        k.onclick = () => {

            ws.send(k.value + ` ${user}`);
            botonesUsados.push(k);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        l.onclick = () => {

            ws.send(l.value + ` ${user}`);
            botonesUsados.push(l);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        単.onclick = () => {

            ws.send(単.value + ` ${user}`);
            botonesUsados.push(単);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        z.onclick = () => {

            ws.send(z.value + ` ${user}`);
            botonesUsados.push(z);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        x.onclick = () => {

            ws.send(x.value + ` ${user}`);
            botonesUsados.push(x);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        c.onclick = () => {

            ws.send(c.value + ` ${user}`);
            botonesUsados.push(c);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        v.onclick = () => {

            ws.send(v.value + ` ${user}`);
            botonesUsados.push(v);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        b.onclick = () => {

            ws.send(b.value + ` ${user}`);
            botonesUsados.push(b);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        n.onclick = () => {

            ws.send(n.value + ` ${user}`);
            botonesUsados.push(n);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }
        m.onclick = () => {

            ws.send(m.value + ` ${user}`);
            botonesUsados.push(m);
            for (i=0; i<botones.length; i++) botones[i].disabled = true;
        }

        ws.addEventListener('message', (data) => {

            if(data.data=='1'){

                window.alert(`El nombre de usuario ${user} ya esta en uso`);
                username.disabled = false;
                submit.disabled = false;
                for (i=0; i<botones.length; i++) botones[i].disabled = true;
            }
            else if ((data.data+"")[0]=="2"){

                palabra = data.data.slice(2);
                inicio = true;
                palabraO = palabra.split('').map(letter => (general.indexOf(letter) >= 0 ? letter : " _ ")).join('');
                palabraR.innerHTML = "Adivina la palabra: "+palabraO;
                for (i=0; i<botones.length; i++) botones[i].disabled = false;
            }
            else if(data.data[data.data.length-1]=="s"){

                for(i=0, j=1; i<palabra.length; i++, j=j+3){

                    if((palabra+"")[i]==(data.data+"")[0]){

                        if(j+1!=palabraO.length){
                            
                            palabraO = palabraO.slice(0,j)+(data.data+"")[0]+palabraO.slice(j+1);
                        }
                        else{

                            palabraO = palabraO.slice(0,j)+(data.data+"")[0];
                        }
                    }
                }
                palabraR.innerHTML = "Adivina la palabra: "+palabraO;
                for (i=0; i<botones.length; i++) botones[i].disabled = false;
                for (i=0; i<botonesUsados.length; i++) botonesUsados[i].disabled = true;
                if (palabraO.indexOf("_")==-1){

                    window.alert("Felicidades, ganaste la partida");
                    for (i=0; i<botones.length; i++) botones[i].disabled = true;
                }
            }
            else if(data.data[data.data.length-1]=="n"){

                for (i=0; i<botones.length; i++) botones[i].disabled = false;
                for (i=0; i<botonesUsados.length; i++) botonesUsados[i].disabled = true;
            }
        })
    })

</script>

<html>
    <head>
        <title>El ahorcado</title>
    </head>
    <body class="container">
        <div class="row mt-4">
            <div class="col-sm-6">
                <div>Aqui va el nombre de usuario</div><br>
                <textarea id="username" cols="15" rows="1"></textarea><br>
                <button id = "submit">Submit</button>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-sm-6">
                <div>Aqui va el dibujo</div>
                <textarea id="pantalla" cols="10" rows="15"></textarea>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-sm-6">
                <p id = "palabraR">Adivina la palabra:</p>
                <button id = "q" value = "q" disabled = true >q</button>
                <button id = "w" value = "w" disabled = true >w</button>
                <button id = "e" value = "e" disabled = true >e</button>
                <button id = "r" value = "r" disabled = true >r</button>
                <button id = "t" value = "t" disabled = true >t</button>
                <button id = "y" value = "y" disabled = true >y</button>
                <button id = "u" value = "u" disabled = true >u</button>
                <button id = "i" value = "i" disabled = true >i</button>
                <button id = "o" value = "o" disabled = true >o</button>
                <button id = "p" value = "p" disabled = true >p</button><br>
                <button id = "a" value = "a" disabled = true >a</button>
                <button id = "s" value = "s" disabled = true >s</button>
                <button id = "d" value = "d" disabled = true >d</button>
                <button id = "f" value = "f" disabled = true >f</button>
                <button id = "g" value = "g" disabled = true >g</button>
                <button id = "h" value = "h" disabled = true >h</button>
                <button id = "j" value = "j" disabled = true >j</button>
                <button id = "k" value = "k" disabled = true >k</button>
                <button id = "l" value = "l" disabled = true >l</button>
                <button id = "単" value = "単" disabled = true >単</button><br>
                <button id = "z" value = "z" disabled = true >z</button>
                <button id = "x" value = "x" disabled = true >x</button>
                <button id = "c" value = "c" disabled = true >c</button>
                <button id = "v" value = "v" disabled = true >v</button>
                <button id = "b" value = "b" disabled = true >b</button>
                <button id = "n" value = "n" disabled = true >n</button>
                <button id = "m" value = "m" disabled = true >m</button>
            </div>
        </div>
    </body>
</html>

<style>

    button [id = q],[id = w],[id = e],[id = r],[id = t],[id = y],[id = u],[id = i],[id = o],[id = p],
    [id = a],[id = s],[id = d],[id = f],[id = g],[id = h],[id = j],[id = k],[id = l],[id = 単],
    [id = z],[id = x],[id = c],[id = v],[id = b],[id = n],[id = m],[id = q] {

        width: 30px;
        height: 30px;
    }

    button [id = submit] {

        width: 50px;
        height: 65px;
    }

</style>